{% extends "base.html" %}

{% block title %}Admin Dashboard - Your PC{% endblock %}

{% block content %}
<h2 style="margin-bottom:12px;">Admin Dashboard</h2>
<p style="color:#a8adb7; margin-top:0;">Signed in as: <strong>{{ session.get('email') }}</strong></p>

<!-- Builds Section -->
<section style="margin-top:24px;">
  <h3>Submitted Build Forms</h3>
  {% if builds and builds|length > 0 %}
  <div style="overflow:auto;">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>User Email</th>
          <th>Brand</th>
          <th>Processor</th>
          <th>Motherboard</th>
          <th>RAM</th>
          <th>SSD</th>
          <th>GPU</th>
          <th>PSU</th>
          <th>Cooling</th>
          <th>AIO</th>
        </tr>
      </thead>
      <tbody>
        {% for b in builds %}
        <tr>
          <td>{{ b.id }}</td>
          <td>{{ b.email }}</td>
          <td>{{ b.brand }}</td>
          <td>{{ b.processor }}</td>
          <td>{{ b.motherboard }}</td>
          <td>{{ b.ram }}</td>
          <td>{{ b.ssd }}</td>
          <td>{{ b.gpu }}</td>
          <td>{{ b.psu }}</td>
          <td>{{ b.cooling }}</td>
          <td>{{ b.aio }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p>No builds submitted yet.</p>
  {% endif %}
</section>

<!-- Orders Section -->
<section style="margin-top:32px;">
  <h3>Orders (Billing &amp; Shipping)</h3>
  {% if orders and orders|length > 0 %}
  <div style="overflow:auto;">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>User Email</th>
          <th>Name</th>
          <th>Address</th>
          <th>Phone</th>
          <th>Total (₹)</th>
          <th>Items</th>
        </tr>
      </thead>
      <tbody>
        {% for o in orders %}
        <tr>
          <td>{{ o.id }}</td>
          <td>{{ o.email }}</td>
          <td>{{ o.name }}</td>
          <td style="max-width:300px; white-space:pre-wrap;">{{ o.address }}</td>
          <td>{{ o.phone }}</td>
          <td>{{ o.total }}</td>
          <td style="max-width:360px; vertical-align: top;">
            {# Prefer items_list (server sets this). Fall back to items. Use bracket lookup to avoid attribute collision. #}
            {% if ('items_list' in o) %}
              {% set items = o['items_list'] %}
            {% elif ('items' in o) %}
              {% set items = o['items'] %}
            {% else %}
              {% set items = [] %}
            {% endif %}

            {% if items and items|length > 0 %}
              <ul style="margin:0; padding-left:18px;">
                {% for item in items %}
                  <li style="margin-bottom:8px;">
                    {# If item is a mapping (dict), use .get safely; otherwise print item itself #}
                    {% if item is mapping %}
                      <strong>{{ item.get('name', '(no name)') }}</strong>
                      {% if item.get('price') %}
                        — ₹{{ item.get('price') }}
                      {% endif %}

                      {% if item.get('specs') %}
                        <div style="font-size:0.9em; color:#666; margin-top:4px;">
                          {% for s in item.get('specs') %}
                            <div>{{ s }}</div>
                          {% endfor %}
                        </div>
                      {% endif %}
                    {% else %}
                      {{ item }}
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <em>No items parsed</em>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p>No orders yet.</p>
  {% endif %}
</section>
{% endblock %}

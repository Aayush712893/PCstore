{% extends "base.html" %}

{% block title %}Admin Dashboard - Your PC{% endblock %}

{% block content %}
<h2 style="margin-bottom:12px;">Admin Dashboard</h2>
<p style="color:#a8adb7; margin-top:0;">Signed in as: <strong>{{ session.get('email') }}</strong></p>

<!-- Products / Stock Section -->
<section style="margin-top:16px;">
  <h3>Products & Stock</h3>
  {% if products and products|length > 0 %}
  <div style="overflow:auto;">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Price (₹)</th>
          <th>Stock</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for p in products %}
        <tr>
          <td>{{ p.id }}</td>
          <td style="min-width:220px;">{{ p.name }}</td>
          <td>{{ p.price }}</td>
          <td>{{ p.stock }}</td>
          <td>
            <!-- Inline update form -->
            <form method="POST" action="{{ url_for('admin_update_stock') }}" style="display:inline;">
              <input type="hidden" name="product_id" value="{{ p.id }}">
              <input name="stock" type="number" min="0" value="{{ p.stock }}" style="width:80px;">
              <button type="submit" class="btn small">Update</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p>No products found.</p>
  {% endif %}
</section>

<!-- Builds Section -->
<section style="margin-top:24px;">
  <h3>Submitted Build Forms</h3>
  {% if builds and builds|length > 0 %}
  <div style="overflow:auto;">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>User Email</th>
          <th>Customer Name</th>
          <th>WhatsApp</th>
          <th>Brand</th>
          <th>Processor</th>
          <th>RAM</th>
          <th>SSD</th>
          <th>GPU</th>
        </tr>
      </thead>
      <tbody>
        {% for b in builds %}
        <tr>
          <td>{{ b.id }}</td>
          <td>{{ b.email }}</td>
          <td>{{ b.customer_name or '-' }}</td>
          <td>{{ b.whatsapp or '-' }}</td>
          <td>{{ b.brand or '-' }}</td>
          <td>{{ b.processor or '-' }}</td>
          <td>{{ b.ram or '-' }}</td>
          <td>{{ b.ssd or '-' }}</td>
          <td>{{ b.gpu or '-' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p>No builds submitted yet.</p>
  {% endif %}
</section>

<!-- Orders Section -->
<section style="margin-top:32px;">
  <h3>Orders (Billing & Shipping)</h3>
  {% if orders and orders|length > 0 %}
  <div style="overflow:auto;">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>User Email</th>
          <th>Name</th>
          <th>Address</th>
          <th>Phone</th>
          <th>Total (₹)</th>
          <th>Items</th>
        </tr>
      </thead>
      <tbody>
        {% for o in orders %}
        <tr>
          <td>{{ o.id }}</td>
          <td>{{ o.email }}</td>
          <td>{{ o.name }}</td>
          <td style="max-width:300px; white-space:pre-wrap;">{{ o.address }}</td>
          <td>{{ o.phone }}</td>
          <td>{{ o.total }}</td>
          <td style="max-width:360px;">
            {% if o.items_list and o.items_list|length > 0 %}
              <ul style="margin:0; padding-left:18px;">
                {% for item in o.items_list %}
                  <li>{{ item.name }} — ₹{{ item.price }}</li>
                {% endfor %}
              </ul>
            {% else %}
              <em>No items parsed</em>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p>No orders yet.</p>
  {% endif %}
</section>
{% endblock %}
